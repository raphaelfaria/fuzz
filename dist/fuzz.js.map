{"version":3,"sources":["fuzz.js","src/item.js","src/fuzz.js"],"names":[],"mappings":"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","file":"fuzz.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Fuzz = factory()\n}(this, function () { 'use strict';\n\n  class Item {\n    constructor(name, index) {\n      this.name = name;\n      this.mainIndex = index;\n      this.weight = 0;\n      this.detailedArray = this._prepareItem();\n    }\n\n    _prepareItem() {\n      function indexIsSectionStart(string, index) {\n        return index === 0 ||\n          (string[index].toUpperCase() === string[index] &&\n            (index === 1 ||\n              string[index - 1].toUpperCase() !== string[index - 1]));\n      }\n\n      return this.name.split('').map((char, index, arr) => {\n        return {\n          index,\n          char,\n          beginSection: indexIsSectionStart(arr, index),\n          weight: 0\n        };\n      });\n    }\n\n    calcMatch(string) {\n      var matchIndex = [];\n      var searchIndex = -1;\n      var lookUpper = true;\n      var testName = this.name;\n      var lowerTestName = this.name.toLowerCase();\n\n      for (var i = 0; i < string.length; i++) {\n        var currentChar = string.charAt(i);\n\n        if (lookUpper) {\n          testName = this.name;\n          currentChar = currentChar.toUpperCase();\n        }\n\n        if (!lookUpper) {\n          testName = lowerTestName;\n        }\n\n        if (searchIndex >= this.name.length) {\n          return false;\n        }\n\n        searchIndex = testName.indexOf(currentChar, searchIndex + 1);\n\n        if (searchIndex > -1) {\n          matchIndex.push(searchIndex);\n        } else {\n          if (lookUpper === false) {\n            matchIndex = [];\n            break;\n          }\n\n          if (lookUpper === true) {\n            i -= 1;\n            searchIndex = matchIndex[matchIndex.length - 1] || -1;\n          }\n\n          lookUpper = !lookUpper;\n        }\n      }\n\n      this.matched = matchIndex;\n\n      // Calculate rank\n      this.calculateWeight();\n\n      return !!(this.matched.length);\n    }\n\n    calculateWeight() {\n      let substringSize = 0;\n\n      this.weight = this.matched.reduce((weight, matchIndex, index) => {\n        if (this.detailedArray[matchIndex].beginSection === true) {\n          this.detailedArray[matchIndex].weight = (80 - matchIndex);\n          weight += this.detailedArray[matchIndex].weight;\n\n          if (this.matched[index - 1] == matchIndex - 1) {\n            substringSize++;\n            this.detailedArray[matchIndex].weight += 15 * Math.pow(2, substringSize) - matchIndex;\n            weight += this.detailedArray[matchIndex].weight;\n          }\n        } else if (this.matched[index - 1] == matchIndex - 1) {\n          substringSize++;\n          this.detailedArray[matchIndex].weight = 15 * Math.pow(2, substringSize) - matchIndex;\n          weight += this.detailedArray[matchIndex].weight;\n        } else {\n          this.detailedArray[matchIndex].weight = 10 - matchIndex;\n          weight += this.detailedArray[matchIndex].weight;\n        }\n\n        weight -= ((this.name.length - 1) - this.matched[this.matched.length - 1]);\n\n        return weight;\n\n      }, 0);\n\n      return this;\n    }\n  }\n\n  class Fuzz extends Array {\n    constructor(collection, options = {}) {\n      super();\n      this.main = collection;\n      this.push.apply(this, this._prepareCollection());\n    }\n\n    parse(item) {\n      return item;\n    }\n\n    _prepareCollection() {\n      return this.main.map((item, i) => {\n        return new Item(this.parse(item), i);\n      });\n    }\n\n    match(string) {\n      let query = string.replace(/\\s+/g, '').toLowerCase();\n      let results = this.filter(item => item.calcMatch(query));\n      console.log(results);\n      return results.sort((a, b) => {\n        if (a.weight > b.weight) {\n          return -1;\n        }\n\n        if (a.weight < b.weight) {\n          return 1;\n        }\n\n        return 0;\n      });\n    }\n  }\n\n  var fuzz = Fuzz;\n\n  return fuzz;\n\n}));\n","class Item {\n  constructor(name, index) {\n    this.name = name;\n    this.mainIndex = index;\n    this.weight = 0;\n    this.detailedArray = this._prepareItem();\n  }\n\n  _prepareItem() {\n    function indexIsSectionStart(string, index) {\n      return index === 0 ||\n        (string[index].toUpperCase() === string[index] &&\n          (index === 1 ||\n            string[index - 1].toUpperCase() !== string[index - 1]));\n    }\n\n    return this.name.split('').map((char, index, arr) => {\n      return {\n        index,\n        char,\n        beginSection: indexIsSectionStart(arr, index),\n        weight: 0\n      };\n    });\n  }\n\n  calcMatch(string) {\n    var matchIndex = [];\n    var searchIndex = -1;\n    var lookUpper = true;\n    var testName = this.name;\n    var lowerTestName = this.name.toLowerCase();\n\n    for (var i = 0; i < string.length; i++) {\n      var currentChar = string.charAt(i);\n\n      if (lookUpper) {\n        testName = this.name;\n        currentChar = currentChar.toUpperCase();\n      }\n\n      if (!lookUpper) {\n        testName = lowerTestName;\n      }\n\n      if (searchIndex >= this.name.length) {\n        return false;\n      }\n\n      searchIndex = testName.indexOf(currentChar, searchIndex + 1);\n\n      if (searchIndex > -1) {\n        matchIndex.push(searchIndex);\n      } else {\n        if (lookUpper === false) {\n          matchIndex = [];\n          break;\n        }\n\n        if (lookUpper === true) {\n          i -= 1;\n          searchIndex = matchIndex[matchIndex.length - 1] || -1;\n        }\n\n        lookUpper = !lookUpper;\n      }\n    }\n\n    this.matched = matchIndex;\n\n    // Calculate rank\n    this.calculateWeight();\n\n    return !!(this.matched.length);\n  }\n\n  calculateWeight() {\n    let substringSize = 0;\n\n    this.weight = this.matched.reduce((weight, matchIndex, index) => {\n      if (this.detailedArray[matchIndex].beginSection === true) {\n        this.detailedArray[matchIndex].weight = (80 - matchIndex);\n        weight += this.detailedArray[matchIndex].weight;\n\n        if (this.matched[index - 1] == matchIndex - 1) {\n          substringSize++;\n          this.detailedArray[matchIndex].weight += 15 * Math.pow(2, substringSize) - matchIndex;\n          weight += this.detailedArray[matchIndex].weight;\n        }\n      } else if (this.matched[index - 1] == matchIndex - 1) {\n        substringSize++;\n        this.detailedArray[matchIndex].weight = 15 * Math.pow(2, substringSize) - matchIndex;\n        weight += this.detailedArray[matchIndex].weight;\n      } else {\n        this.detailedArray[matchIndex].weight = 10 - matchIndex;\n        weight += this.detailedArray[matchIndex].weight;\n      }\n\n      weight -= ((this.name.length - 1) - this.matched[this.matched.length - 1]);\n\n      return weight;\n\n    }, 0);\n\n    return this;\n  }\n}\n\nexport default Item;\n","import Item from './item';\n\nclass Fuzz extends Array {\n  constructor(collection, options = {}) {\n    super();\n    this.main = collection;\n    this.push.apply(this, this._prepareCollection());\n  }\n\n  parse(item) {\n    return item;\n  }\n\n  _prepareCollection() {\n    return this.main.map((item, i) => {\n      return new Item(this.parse(item), i);\n    });\n  }\n\n  match(string) {\n    let query = string.replace(/\\s+/g, '').toLowerCase();\n    let results = this.filter(item => item.calcMatch(query));\n    console.log(results);\n    return results.sort((a, b) => {\n      if (a.weight > b.weight) {\n        return -1;\n      }\n\n      if (a.weight < b.weight) {\n        return 1;\n      }\n\n      return 0;\n    });\n  }\n}\n\nexport default Fuzz;\n"],"sourceRoot":"/source/"}